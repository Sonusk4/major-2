@echo off
REM Test script for profile picture upload

REM First, generate a test image (1x1 pixel PNG)
powershell -Command "[System.IO.File]::WriteAllBytes('test-image.png', @(0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53, 0xDE, 0x00, 0x00, 0x00, 0x0C, 0x49, 0x44, 0x41, 0x54, 0x08, 0x99, 0x63, 0xF8, 0x0F, 0x00, 0x00, 0x01, 0x01, 0x00, 0x01, 0x00, 0x1B, 0xB6, 0xEE, 0x56, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82))"

echo Testing Profile Picture Upload
echo ==============================
echo.

REM Use Node to generate JWT token
for /f "delims=" %%A in ('node -e "const jwt = require('jsonwebtoken'); const token = jwt.sign({ id: '692ffeaeba805bfb454ff33d' }, process.env.JWT_SECRET || 'test'); console.log(token);"') do set TOKEN=%%A

echo Token: %TOKEN%
echo.

REM Test the upload endpoint
echo Uploading image to http://localhost:3000/api/profile/upload-picture
echo.

curl -X POST http://localhost:3000/api/profile/upload-picture ^
  -H "Authorization: Bearer %TOKEN%" ^
  -F "file=@test-image.png" ^
  -v

echo.
echo Cleaning up test image...
del test-image.png

echo Done!
